# Canonical Domain Schema — KERI C3 Service Domain
# Every domain.yaml in docs/{ecosystem}/{system}/{stack}/domain/ follows this shape.
# Produced by /keri-c3-service-domain, consumed by C4 runtime selection.
#
# Example comments use a witness-pool stack for illustration.

version: "1.0"

# --- Parent references ---
# Links this domain to its C2 stack, C1 system, and C0 ecosystem.
domain:
  stack: ""                     # Reference to stack.yaml name (e.g., "acme-witness-pool")
  system: ""                    # Reference to system.yaml name (e.g., "verify-me")
  ecosystem: ""                 # Reference to ecosystem.yaml name (e.g., "financial-services")

# --- Components ---
# Each component is a KERI domain primitive deployed within this stack.
#
# Example:
# - name: witness-event-log-engine
#   type: event-log-engine
#   purpose: "Deterministic key state machine for validating events before witness receipting"
#   operations:
#     - name: validate_event
#       description: "Validate incoming event against prior key state"
#       inputs: [event, prior_key_state]
#       outputs: [validation_result]
#     - name: compute_key_state
#       description: "Replay KEL to compute current key state for a prefix"
#       inputs: [prefix]
#       outputs: [key_state]
#   state:
#     - name: kel_store
#       storage_mapping: WitnessKELTable     # AWS resource logical name from stack.yaml
#       description: "Append-only key event log per AID prefix"
#   invariants:
#     - "Sequence numbers must increment by exactly 1"
#     - "Next key digest must match rotated-in keys"
#     - "Signatures must verify against current signing keys"
#   failure_modes:
#     - condition: "Event with duplicate sequence number but different SAID"
#       impact: "Duplicity — controller may be compromised"
#       recovery: "Record both versions, alert watcher network"
#   observability:
#     metrics: [events_validated, validation_failures, kel_depth]
#     logs: [event_received, validation_result, duplicity_detected]
#     traces: [validate_event_span, compute_key_state_span]
#   dependencies: []
components:
  - name: ""
    type: ""                    # event-log-engine | witness-service | watcher-service
                                # | keri-agent | acdc-registry | delegator
                                # | oobi-resolver | judge-jury
    purpose: ""
    operations:
      - name: ""
        description: ""
        inputs: []
        outputs: []
    state:
      - name: ""
        storage_mapping: ""     # AWS resource logical name from stack.yaml
        description: ""
    invariants: []              # Protocol rules this component enforces
    failure_modes:
      - condition: ""
        impact: ""
        recovery: ""
    observability:
      metrics: []
      logs: []
      traces: []
    dependencies: []            # Names of other components in this domain

# --- Data Structures ---
# KERI protocol data structures used by components in this domain.
#
# Example:
# - name: InceptionEvent
#   type: key-event
#   fields:
#     - name: v
#       type: string
#       description: "Version string (e.g., KERI10JSON00011c_)"
#       constraints: "Must match version regex"
#     - name: t
#       type: string
#       description: "Event type"
#       constraints: "Must be 'icp'"
#     - name: d
#       type: string
#       description: "SAID (Self-Addressing Identifier)"
#       constraints: "Must be valid CESR-qualified digest"
#     - name: i
#       type: string
#       description: "AID prefix (self-referential for inception)"
#       constraints: "Must equal d for self-addressing AIDs"
#   serialization:
#     - format: cesr
#     - format: json
#     - format: cbor
data_structures:
  - name: ""
    type: ""                    # key-event | acdc | receipt | tel-event | oobi | key-state
    fields:
      - name: ""
        type: ""
        description: ""
        constraints: ""
    serialization:
      - format: ""              # cesr | json | cbor | msgpack

# --- Runtime Recommendation ---
# Suggested language and library for implementing this domain.
# Based on stack type, performance requirements, and ecosystem conventions.
#
# Example:
# language: python
# library: keripy
# rationale: "Witness pool requires full KEL validation; keripy is the reference implementation with complete witness support"
runtime_recommendation:
  language: ""                  # python | typescript | rust
  library: ""                   # keripy | signify-ts | keriox | cesride
  rationale: ""
